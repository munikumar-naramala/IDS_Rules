# Sagan ms-defender.rules
# Copyright (c) 2009-2022. Quadrant Information Security <www.quadrantsec.com>
# All rights reserved.
#
# Please submit any custom rules or ideas to sagan-submit@quadrantsec.com or the sagan-sigs mailing list
#
#*************************************************************
#  Redistribution and use in source and binary forms, with or without modification, are permitted provided that the
#  following conditions are met:
#
#  * Redistributions of source code must retain the above copyright notice, this list of conditions and the following
#    disclaimer.
#  * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the
#    following disclaimer in the documentation and/or other materials provided with the distribution.
#  * Neither the name of the nor the names of its contributors may be used to endorse or promote products derived
#    from this software without specific prior written permission.
#
#  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY EXPRESS OR IMPLIED WARRANTIES,
#  INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
#  DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
#  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
#  SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
#  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE
#  USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#
#*************************************************************


alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Scan Started"; event_id: 1000; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005234; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Scan Completed"; event_id: 1001; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid: 5005235; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Scan Canceled"; event_id: 1002; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005236; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Scan Paused"; event_id: 1003; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005237; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Scan Resumed"; event_id: 1004; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005238; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Scan Failed"; event_id: 1005; classtype: system-error; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005239; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Engine Found Potential Malware"; event_id: 1006; classtype: suspicious-traffic; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005240; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Action Performed Against Potential Malware"; event_id: 1007; classtype: suspicious-traffic; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005241; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Action Performed Against Potential Malware Failed"; event_id: 1008; classtype: system-error; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005242; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Platform Restored An Item From Quarantine"; event_id: 1009; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005243; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Platform Could Not Restore An Item From Quarantine"; event_id: 1010; classtype: system-error; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005244; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Platform Deleted An Item From Quarantine"; event_id: 1011; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005245; rev: 2;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Platform Could Not Delete An Item From Quarantine"; event_id: 1012; classtype: system-error; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005246; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Platform Deleted History Of Malware"; event_id: 1013; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005247; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Platform Could Not Delete History Of Malware"; event_id: 1014; classtype: system-error; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005248; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Platform Detected Suspicious Behavior"; event_id: 1015; classtype: suspicious-traffic; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005249; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Platform Detected Potential Malware"; event_id: 1116; classtype: suspicious-traffic; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005250; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Action Performed Against Potential Malware [2]"; event_id: 1117; classtype: suspicious-traffic; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005251; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Action Performed Against Potential Malware Failed [2]"; event_id: 1118; classtype: system-error; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid: xxxxxxxx; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Critical Error When Trying To Take Action On Malware"; event_id: 1119; classtype: system-error; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005252; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Microsoft Defender Antivirus Has Deduced The Hashes For A Threat Resource"; event_id: 1120; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005253; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Platform Healthy State Event"; event_id: 1150; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005254; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Endpoint Protection Client Health Report"; event_id: 1151; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005255; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Definitions Updated Successfully"; event_id: 2000; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005256; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Security Intelligence Update Failed"; event_id: 2001; classtype: system-error; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005257; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Engine Updated Successfully"; event_id: 2002; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005258; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Engine Update Failed"; event_id: 2003; classtype: system-error; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005259; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Problem Loading Antimalware Definitions"; event_id: 2004; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005260; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Out of Date Antimalware Platform"; event_id: 2005; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005261; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Platform Update Failed"; event_id: 2006;  classtype: system-error; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005262; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Platform Will Soon Be Out Of Date"; event_id: 2007; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005263; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Engine Used The Dynamic Signature Service To Get Additional Definitions"; event_id: 2010; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005264; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Out-Of-Date Dynamic Definitions Deleted"; event_id: 2011; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005265; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Error When Trying To Use Dynamic Signature Service"; event_id: 2012; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005266; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] All Dynamic Definitions Deleted"; event_id: 2013; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005267; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Engine Downloaded A Clean File"; event_id: 2020; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005268; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Engine Failed To Download A Clean File"; event_id: 2021; classtype: system-error; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005269; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Engine Was Downloaded And Is Configured To Run Offline On Next System Restart"; event_id: 2030; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005270; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Engine Was Unable To Download And Configure An Offline Scan"; event_id: 2031; classtype: system-error; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005271; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Support For This Operating System Version Will Soon End"; event_id: 2040; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005272; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Support For This Operating System Has Ended"; event_id: 2041; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005273; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Engine No Longer Supports This Operating System"; event_id: 2042; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid: 5005274; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Real-Time Protection Encountered An Error And Failed"; event_id: 3002; classtype: system-error; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005275; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Real-Time Protection Recovered From A Failure"; event_id: 3007; classtype: system-error; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005276; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Real-Time Protection Is Enabled"; event_id: 5000; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005277; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Real-Time Protection Is Disabled"; event_id: 5001; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005278; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Real-Time Protection Configuration Changed"; event_id: 5004; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005279; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Platform Configuration Changed"; event_id: 5007; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005280; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Engine Encountered An Error And Failed"; event_id: 5008; classtype: system-error; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005281; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Scanning For Malware is Enabled"; event_id: 5009; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005282; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Scanning For Malware is Disabled"; event_id: 5011; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005283; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Scanning For Viruses is Enabled"; event_id: 5012; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005284; rev: 1;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Scanning For Viruses is Disabled"; event_id: 5100; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005285; rev: 1;)
#alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Platform Will Expire Soon"; event_id: 5100; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005286; rev: 4;)
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[MS-DEFENDER] Antimalware Platform Is Expired"; event_id: 5101; classtype: system-event; reference: url,docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus; sid:5005287; rev: 3;)

